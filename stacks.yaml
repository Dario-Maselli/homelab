# Repo-controlled stack list for the watcher
# This file lives in the homelab repo… committed and versioned with the infrastructure code
# It is used by the watcher to determine which stacks to watch and how to configure them
stacks:
  - dir: all_the_rrs
    compose: docker-compose.yaml

  - dir: automation
    compose: docker-compose.yaml

  - dir: authentication
    compose: docker-compose.yaml
    # If authentication (or any other stack) doesn’t need env… omit env entirely or keep optional: true
    env:
      backend: vault
      secret_path: kv/homelab/authentication
      data_key: env
      optional: true
      materialize:
        enabled: true # force writing an env file next to each compose
        filename: ".env" # name to write next to compose files
        fallback_global: false # if a stack has no fetched env, copy the watcher .env into the stack dir

  - dir: core
    compose: docker-compose.yaml

  - dir: databases
    compose: docker-compose.yaml
    env:
      backend: vault
      secret_path: kv/homelab/databases
      data_key: env
      optional: true
      materialize:
        enabled: true # force writing an env file next to each compose
        filename: ".env" # name to write next to compose files
        fallback_global: false # if a stack has no fetched env, copy the watcher .env into the stack dir

  - dir: media
    compose: docker-compose.yaml

  - dir: monitoring
    compose: docker-compose.yaml
    env:
      backend: vault
      secret_path: kv/homelab/monitoring
      data_key: env
      optional: true
      materialize:
        enabled: true # force writing an env file next to each compose
        filename: ".env" # name to write next to compose files
        fallback_global: false # if a stack has no fetched env, copy the watcher .env into the stack dir

  - dir: sentry
    compose: docker-compose.yaml
    env:
      backend: vault
      secret_path: kv/homelab/sentry
      data_key: env
      optional: true
      materialize:
        enabled: true # force writing an env file next to each compose
        filename: ".env" # name to write next to compose files
        fallback_global: false # if a stack has no fetched env, copy the watcher .env into the stack dir
